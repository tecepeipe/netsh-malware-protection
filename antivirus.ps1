# Copy-Item -Source \\server\share\file -Destination C:\path\
# (New-Object System.Net.WebClient).DownloadFile("https://domain.com/file.txt","file.txt")
# Invoke-WebRequest "http://www.contoso.com" -OutFile "file" -PassThru | Select-Object -ExpandProperty Content

[Net.ServicePointManager]::SecurityProtocol = "tls12, tls11"

Invoke-WebRequest "https://ransomwaretracker.abuse.ch/downloads/RW_DOMBL.txt" -OutFile "ransomwaretracker.txt"
Invoke-WebRequest "https://www.dshield.org/feeds/suspiciousdomains_Low.txt" -OutFile "dshield.txt"
Invoke-WebRequest "http://mirror1.malwaredomains.com/files/domains.txt" -OutFile "malwaredomains.txt"

Get-Content malwaredomains.txt | Where-Object {$_ -notmatch "^#"} | %{ $_.Split([char]9)[2] } > domains.txt
Get-Content ransomwaretracker.txt,dshield.txt | Where-Object {$_ -notmatch "^#"} >> domains.txt

$hosts = "$env:windir\System32\drivers\etc\hosts"
get-content domains.txt | ForEach-Object {
  "127.0.0.1    $_" | Add-Content $hosts
}

Invoke-WebRequest "http://mirror1.malwaredomains.com/files/domains.txt" -OutFile "malwaredomains.txt"
Invoke-WebRequest "https://iplists.firehol.org/files/firehol_level1.netset" -OutFile "level1.txt"
Invoke-WebRequest "https://iplists.firehol.org/files/firehol_webclient.netset" -OutFile "webclient.txt"

Get-Content level1.txt,webclient.txt | Where-Object {$_ -notmatch "^#|10.0.0.0|192.168.0.0|172.16.0.0|100.64.0.0"} | ForEach-Object {
  New-NetFirewallRule -Name "xxMalicious_$_" -DisplayName "xxMalicious_$_" -Enabled 1 -Direction Outbound -Action Block -Protocol TCP -RemoteAddress $_
}

Remove-Item ransomwaretracker.txt,dshield.txt,malwaredomains.txt
Remove-Item level1.txt,webclient.txt
Remove-Item domains.txt