@echo off

wget -q -O ransomwaretracker.txt  https://ransomwaretracker.abuse.ch/downloads/RW_DOMBL.txt 
wget -q -O dshield.txt            https://www.dshield.org/feeds/suspiciousdomains_Low.txt
wget -q -O malwaredomains.txt     http://mirror1.malwaredomains.com/files/domains.txt  

cat ransomwaretracker.txt | grep -v ^#  > domains.txt
cat dshield.txt | grep -v ^# >> domains.txt
cat malwaredomains.txt | grep -v ^#  | cut -f 3 >> domains.txt

cat domains.txt | sed s/$/^/ | sed s/$/" "127.0.0.1/ | awk "{ print $2, \"  \",  $1 }" >> %WINDIR%\system32\drivers\etc\hosts

wget -q -O level1.txt     https://iplists.firehol.org/files/firehol_level1.netset 
wget -q -O webclient.txt  https://iplists.firehol.org/files/firehol_webclient.netset

egrep -v "^#|10.0.0.0|192.168.0.0|172.16.0.0|100.64.0.0" level1.txt > malicious.txt 
grep -v ^#  webclient.txt >> malicious.txt 
cat malicious.txt | sed s/$/^/  > malicious2.txt

FOR /F %%h in (malicious2.txt) do netsh advfirewall firewall add rule name="Malicious_%%h" dir=out action=block protocol=TCP remoteip=%%h

del domains.txt
del malicious.txt
del malicious2.txt